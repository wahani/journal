
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Functional Programming With lambda.r - Journal</title>
  <meta name="author" content="Sebastian Warnholz">

  
  <meta name="description" content="Exploring the R-package lambda.r and a functional programming style for data manipulation.">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wahani.github.io/journal/blog/2014/06/15/Functional-Programming-with-lambdar">
  <link href="/journal/favicon.png" rel="icon">
  <link href="/journal/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/journal/atom.xml" rel="alternate" title="Journal" type="application/atom+xml">
  <script src="/journal/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/journal/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
<!--- MathJax Configuration -->
<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/journal/">Journal</a></h1>
  
    <h2>Notes from seb!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
  
</ul>

<ul class="main-navigation">
  <li><a href="/journal/">Blog</a></li>
  <li><a href="/journal/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Functional Programming With lambda.r</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-15T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>My first post was on <a href="/journal/Introducing-S4-Methods/">S4-methods</a> and how I could add new features to a function without changing it – using function dispatch in S4. This works out fine, but is not optimal for me. </p>

<ul>
  <li>The function <code>setMethod</code> introduces code which is dificult to read</li>
  <li>The dispatch uses classes not attributes or different conditions for dispatch</li>
  <li>I am not trained to use object orientation as a programming style (I am not at all trained as a programmer) and after using it in a project I think if I want to get started with object orientation maybe I should not use a functional language to begin with</li>
  <li>I would never use S4 outside package delelopment</li>
  <li>And S4 is not playing nice with roxygen2, it took me hours to adjust my workflow</li>
</ul>

<p>So I wanted to get back to the functional programming techniques available in R. Here <a href="http://cran.r-project.org/web/packages/lambda.r/index.html">lambda.r</a> seems to be a nice addition to what R already offers. Especially the capability of dispatching functions. So here is an example.
<!--more-->
## Example function</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>magrittr<span class="p">)</span>
dat <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="kp">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> length.out<span class="o">=</span><span class="m">10</span><span class="p">)),</span> group <span class="o">=</span> <span class="kp">gl</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>

applyFun <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>dat<span class="p">,</span> var<span class="p">,</span> fun<span class="p">,</span> <span class="kp">by</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  <span class="kp">split</span><span class="p">(</span>dat<span class="p">,</span> dat<span class="p">[</span><span class="kp">by</span><span class="p">])</span> <span class="o">%&gt;%</span> <span class="kp">lapply</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span>df<span class="p">)</span> <span class="p">{</span>
    df<span class="p">[[</span>var<span class="p">]]</span> <span class="o">&lt;-</span> fun<span class="p">(</span>df<span class="p">[[</span>var<span class="p">]],</span> <span class="kc">...</span><span class="p">)</span>
    df
    <span class="p">})</span> <span class="o">%&gt;%</span> <span class="kp">do.call</span><span class="p">(</span>what<span class="o">=</span><span class="kp">rbind</span><span class="p">)</span>
  <span class="p">}</span>

applyFun<span class="p">(</span>dat<span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="kp">mean</span><span class="p">,</span> <span class="s">&quot;group&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##             x group
## 1.1  1.966370     1
## 1.2  1.966370     1
## 1.3  1.966370     1
## 1.4  1.966370     1
## 1.5  1.966370     1
## 2.6  4.230699     2
## 2.7  4.230699     2
## 2.8  4.230699     2
## 2.9  4.230699     2
## 2.10 4.230699     2</code></pre></div>

<p>The function <code>applyFun</code> will apply <code>fun</code> on a subset denoted by <code>group</code> and the variable <code>var</code>. This may be usefull if you do transformations on single variables which are different in each group, or you do not want your data collapsed, i.e. preserve the original number of rows. <code>group</code> for example can be a chracter with <code>length &gt; 1</code>, I can plug in any function wich will return a scalar or a vector with the length of the input. However, it will only work on a single variable in the data, so <code>var</code> schould have length 1. I could try something with <code>[</code> instead of <code>[[</code> for subsetting but then the requirements for <code>fun</code> will change and I do want to preserve the behaviour of <code>applyFun</code>.</p>

<h2 id="how-can-lambdar-help">How can lambda.r help?</h2>

<p>There are different possibilities to allow vectors in the argument <code>var</code> of <code>applyFun</code>:     <br />
* rewrite <code>applyFun</code>
* write a new function calling <code>applyFun</code>
* write a function called <code>applyFun</code> calling the version of <code>applyFun</code> where <code>var</code> is a scalar: use the function dispatch introduced in lambda.r
* And of course many more…</p>

<p>I don’t like the first choice, I have a running collection of functions and they like each other so I like the function the way it is. The second would be okay, but I am not very creative in comming up with new function names; and remembering them is even harder. Let’s see how the third option is working out:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>lambda.r<span class="p">)</span>
<span class="kp">rm</span><span class="p">(</span>applyFun<span class="p">)</span>

<span class="c1"># Version of lambda.r if length(var) == 1</span>
applyFun<span class="p">(</span>dat<span class="p">,</span> var<span class="p">,</span> fun<span class="p">,</span> <span class="kp">by</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="o">%when%</span> <span class="p">{</span>
  <span class="kp">length</span><span class="p">(</span>var<span class="p">)</span> <span class="o">==</span> <span class="m">1</span>
<span class="p">}</span> <span class="o">%as%</span> <span class="p">{</span>
  <span class="kp">split</span><span class="p">(</span>dat<span class="p">,</span> dat<span class="p">[</span><span class="kp">by</span><span class="p">])</span> <span class="o">%&gt;%</span> <span class="kp">lapply</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span>df<span class="p">)</span> <span class="p">{</span>
    df<span class="p">[[</span>var<span class="p">]]</span> <span class="o">&lt;-</span> fun<span class="p">(</span>df<span class="p">[[</span>var<span class="p">]],</span> <span class="kc">...</span><span class="p">)</span>
    df
  <span class="p">})</span> <span class="o">%&gt;%</span> <span class="kp">do.call</span><span class="p">(</span>what<span class="o">=</span><span class="kp">rbind</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Version of lambda.r if length(var) != 1</span>
applyFun<span class="p">(</span>dat<span class="p">,</span> var<span class="p">,</span> fun<span class="p">,</span> <span class="kp">by</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="o">%as%</span> <span class="p">{</span>
  <span class="kr">for</span> <span class="p">(</span>varName <span class="kr">in</span> var<span class="p">)</span> <span class="p">{</span>
    dat <span class="o">&lt;-</span> applyFun<span class="p">(</span>dat<span class="p">,</span> varName<span class="p">,</span> fun<span class="p">,</span> <span class="kp">by</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
  <span class="p">}</span>
  dat
<span class="p">}</span>

applyFun<span class="p">(</span>dat<span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="kp">mean</span><span class="p">,</span> <span class="s">&quot;group&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##             x group
## 1.1  1.966370     1
## 1.2  1.966370     1
## 1.3  1.966370     1
## 1.4  1.966370     1
## 1.5  1.966370     1
## 2.6  4.230699     2
## 2.7  4.230699     2
## 2.8  4.230699     2
## 2.9  4.230699     2
## 2.10 4.230699     2</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">dat<span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">)</span>
applyFun<span class="p">(</span>dat<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">),</span> <span class="kp">mean</span><span class="p">,</span> <span class="s">&quot;group&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##               x group           y
## 1.1.1  1.966370     1 -0.23740634
## 1.1.2  1.966370     1 -0.23740634
## 1.1.3  1.966370     1 -0.23740634
## 1.1.4  1.966370     1 -0.23740634
## 1.1.5  1.966370     1 -0.23740634
## 2.2.6  4.230699     2 -0.05986417
## 2.2.7  4.230699     2 -0.05986417
## 2.2.8  4.230699     2 -0.05986417
## 2.2.9  4.230699     2 -0.05986417
## 2.2.10 4.230699     2 -0.05986417</code></pre></div>

<p>With <code>%when%</code> I introduce a condition, or multiple conditions, which needs to evaluate to <code>TRUE</code>. If it does the function body introduced by <code>%as%</code> is evaluated exactly like before. So I am generating a couple of more lines, but I can reuse the function body of the original <code>applyFun</code> definition. The second definition of <code>applyFun</code> is what will be called if <code>length(var) != 1</code>. So something like the else statement in a if-else clause. Like in a if-else control structure the order is important. So either I control access using a second <code>%when%</code> or the definition needs to be after the ‘<code>length(var) == 1</code>’ version, which I did here.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sebastian Warnholz</span></span>

      








  


<time datetime="2014-06-15T00:00:00+02:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/journal/blog/categories/fp/'>fp</a>, <a class='category' href='/journal/blog/categories/lambda-dot-r/'>lambda.r</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://wahani.github.io/journal/blog/2014/06/15/Functional-Programming-with-lambdar" data-via="" data-counturl="http://wahani.github.io/journal/blog/2014/06/15/Functional-Programming-with-lambdar" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/journal/blog/2014/06/03/Simulations-in-Small-Area-Estimation" title="Previous Post: saeSim: Simulation Tools in Small Area Estimation">&laquo; saeSim: Simulation Tools in Small Area Estimation</a>
      
      
        <a class="basic-alignment right" href="/journal/blog/2015/01/13/Setup-Jekyll-Octopress-and-knitr-for-workflow" title="Next Post: Setup Jekyll Octopress and knitr for workflow">Setup Jekyll Octopress and knitr for workflow &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

  <aside class="sidebar">
   
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wahani.github.io/journal" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/journal/blog/2015/01/26/Notes">2015-01-26-Notes</a>
      </li>
    
      <li class="post">
        <a href="/journal/blog/2015/01/22/notes">2015-01-22 Notes</a>
      </li>
    
      <li class="post">
        <a href="/journal/blog/2015/01/13/Setup-Jekyll-Octopress-and-knitr-for-workflow">Setup Jekyll Octopress and Knitr for Workflow</a>
      </li>
    
      <li class="post">
        <a href="/journal/blog/2014/06/15/Functional-Programming-with-lambdar">Functional Programming With lambda.r</a>
      </li>
    
      <li class="post">
        <a href="/journal/blog/2014/06/03/Simulations-in-Small-Area-Estimation">saeSim: Simulation Tools in Small Area Estimation</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/wahani">@wahani</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'wahani',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/journal/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>



    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Sebastian Warnholz -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script>
  $(document).ready(function() {  
  var stickyNavTop = $('nav').offset().top;  
    
  var stickyNav = function(){  
  var scrollTop = $(window).scrollTop();  
         
  if (scrollTop > stickyNavTop) {   
      $('nav').addClass('sticky');  
  } else {  
      $('nav').removeClass('sticky');   
  }  
  };  
    
  stickyNav();  
    
  $(window).scroll(function() {  
      stickyNav();  
  });  
  });  
</script>


</body>
</html>
